<!-- Success Alert -->
<div *ngIf="showSuccessAlert()" class="alert alert-success position-fixed top-0 end-0 m-3" role="alert" style="z-index: 1050;">
  Profile updated successfully!
</div>

<!-- Angular Modal for Profile Update -->
<div *ngIf="showProfileModal()" class="modal-backdrop fade show" style="z-index: 1040;"></div>
<div *ngIf="showProfileModal()" class="modal d-block" tabindex="-1" style="z-index: 1050;">
  <div class="modal-dialog">
    <form class="modal-content" (ngSubmit)="submitProfileUpdate()">
      <div class="modal-header">
        <h5 class="modal-title">Update Profile</h5>
        <button type="button" class="btn-close" (click)="closeProfileForm()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Name</label>
          <input [(ngModel)]="profileForm.name" name="name" type="text" class="form-control" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Contact Number</label>
          <input [(ngModel)]="profileForm.contactNumber" name="contactNumber" type="text" class="form-control" required />
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input [(ngModel)]="profileForm.password" name="password" type="password" class="form-control" required />
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Update</button>
        <button type="button" class="btn btn-secondary" (click)="closeProfileForm()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Profile Table -->
<div *ngIf="userProfile()" class="container my-4">
  <h3 class="text-primary">Your Profile</h3>
  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Contact Number</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ userProfile()?.name }}</td>  
          <td>{{ userProfile()?.email }}</td>
          <td>{{ userProfile()?.contactNumber }}</td>
          <td>{{ userProfile()?.role }}</td>
          <td>
            <button class="btn btn-outline-primary btn-sm" (click)="openProfileForm()">Update Profile</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>


<!-- Filter Section -->

<div class="container my-5 buyer-container">
  <h2 class="mb-4">Filter Auctions</h2>
  <div class="table-responsive mb-4">
    <table class="table table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Category</th>
          <th>Min Bid</th>
          <th>Max Bid</th>
          <th>Time Left (hrs)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <select class="form-select" [(ngModel)]="filterData.category">
              <option value="">Select a category</option>
              <option value="Electronics">Electronics</option>
              <option value="Fashion">Fashion</option>
              <option value="Home & Garden">Home & Garden</option>
              <option value="Collectibles">Collectibles</option>
              <option value="Sports & Outdoors">Sports & Outdoors</option>
              <option value="Books">Books</option>
              <option value="Vehicles">Vehicles</option>
              <option value="Art">Art</option>
              <option value="Other">Other</option>
            </select>
          </td>
          <td><input type="number" class="form-control" placeholder="Min Bid" [(ngModel)]="filterData.minBid" /></td>
          <td><input type="number" class="form-control" placeholder="Max Bid" [(ngModel)]="filterData.maxBid" /></td>
          <td><input type="number" class="form-control" placeholder="Time Left (hrs)" [(ngModel)]="filterData.timeLeftInHours" /></td>
          <td class="d-flex gap-2">
            <button class="btn btn-secondary" (click)="applyFilters()">Apply Filter</button>
            <button class="btn btn-secondary" (click)="resetFilter()">Back</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- No Auctions Found -->

  <div *ngIf="noAuctionsFound()" class="alert alert-warning text-center">
    <p>No auctions available with selected filters. Try another.</p>
    <button class="btn btn-outline-secondary mt-2" (click)="resetFilter()">Back</button>
  </div>

  <!-- Product Details -->

  <div *ngIf="showProductDetails() && selectedProduct()" class="container my-4">
    <h3 class="mb-3 text-primary">Product Details</h3>
    <div class="table-responsive mb-3">
      <table class="table table-bordered align-middle">
        <thead class="table-dark">
          <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Category</th>
            <th>Start Price</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ selectedProduct()?.title }}</td>
            <td>{{ selectedProduct()?.description }}</td>
            <td>{{ selectedProduct()?.category }}</td>
            <td>₹{{ selectedProduct()?.startPrice }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <button class="btn btn-outline-secondary" (click)="backToList()">Back</button>
  </div>

  <!-- Auction List -->

  <div *ngIf="!showProductDetails()" class="container my-4">
    <h2 class="mb-3 text-primary">Auctions</h2>
    <div class="table-responsive">
      <table class="table table-bordered align-middle product-details-table">
        <thead class="table-dark">
          <tr>
            <th>Title</th>
            <th>Start</th>
            <th>End</th>
            <th>Bid</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let auction of filteredAuctions()" [ngClass]="getAuctionStatus(auction)">
            <td>{{ auction.title }}</td>
            <td>{{ auction.startDate | date:'short' }}</td>
            <td>{{ auction.endDate | date:'short' }}</td>
            <td>₹{{ auction.currentBid }}</td>
            <td>{{ getAuctionStatus(auction) }}</td>
            <td>
              <div class="d-flex flex-wrap gap-2">
                <button
                  *ngIf="getAuctionStatus(auction) !== 'completed' || winnerAuctions().includes(auction.auctionId)"
                  class="btn btn-info btn-sm"
                  (click)="viewProduct(auction.productId)">
                  View Product
                </button>
                <button
                  *ngIf="getAuctionStatus(auction) === 'live'"
                  class="btn btn-success btn-sm"
                  (click)="bidNow(auction.auctionId)">
                  Bid Now
                </button>
                <button
                  *ngIf="getAuctionStatus(auction) === 'completed' && winnerAuctions().includes(auction.auctionId)"
                  class="btn btn-warning btn-sm"
                  (click)="goToPayment(auction.auctionId)">
                  Make Payment
                </button>
                <button
                  *ngIf="getAuctionStatus(auction) === 'completed' && winnerAuctions().includes(auction.auctionId)"
                  class="btn btn-outline-dark btn-sm"
                  (click)="goToReview(auction.auctionId)">
                  Add Review
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
